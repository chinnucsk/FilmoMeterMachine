<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>FilmoMeter - Serving movie nerds since 2013</title>
		<link rel="stylesheet" href="/css/style.css">
	</head>
	<body id="home">
		<div id="layout">
			<header>
				<h1 id="logo">
					<a href="./">Filmo<span class="light">Meter</span></a>
				</h1>
				<h5>Never watch a lame-ass movie ever again</h5>
			</header>
			<hr class="noscreen">
			<section class="search">
				<form action="">
					<input class="keyword" type="text" placeholder="Movie title"></input>
					<span class="search-icon"></span>
					<div class="spinner"></div>
				</form>
			</section>
			<hr class="noscreen">
			<section class="result">
				<table>
					<tbody>
						<tr>
							<td colspan="2">
								<label>Verdict: </label>
								<meter min="0" max="10" title="score" data-bind="attr:{value: averageRating}"></meter>
							</td>
						</tr>
						<tr>
							<td class="poster">
								<img class="poster" data-bind="attr:{src: $root.ratings()[1].poster}"></img>
							</td>
							<td>
								<ul>
									<li>
										<label>Title:</label>
										<span data-bind="text: $root.ratings()[0].title"></span>
									</li>
									<li>
										<label>Rating:</label>
										<span data-bind="text: averageRating"></span>
									</li>
									<li>
										<label>Year:</label>
										<span data-bind="text: $root.ratings()[0].year"></span>
									</li>
									<li>
										<label>Actors:</label>
										<span data-bind="text: $root.ratings()[0].actors"></span>
									</fieldset>
								</ul>
							</td>
						</tr>
					</tbody>
				</table>
			</section>
			<section class="no-result">
				<p>I haz no such movie :(</p>
			</section>
			<footer>
				<span>Â© 2012 Safwan Kamarrudin</span>
			</footer>

			<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
			<script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/knockout/knockout-2.2.0.js"></script>
			<script type="text/javascript" src="https://raw.github.com/SteveSanderson/knockout.mapping/master/build/output/knockout.mapping-latest.js"></script>
			<script type="text/javascript">
				$(document).ready(function() {
					var keyword = $(':text');
      				var spinner = $('.spinner');
      				var result = $('.result');
      				var noResult = $('.no-result');

      				$('form').submit(function(e){
    					e.preventDefault();
					});

      				search = function() {
      					if (keyword.val() != '') {
							spinner.css('visibility','visible');
							result.slideUp();
							noResult.slideUp();

							$.getJSON('/search?title=' + keyword.val(), function(data) {
								spinner.css('visibility','hidden');

								if (data == null) {
									noResult.slideDown();
								}
								else {
									result.slideDown();
									var viewModel = ko.mapping.fromJS(data);
									ko.applyBindings(viewModel);
								}
							});
						}
      				};

					keyword.keypress(function(e) {
						// Enter key
						if (e.which == 13) {
							search();
						}
					});
				});
			</script>
		</div>
	</body>
</html>