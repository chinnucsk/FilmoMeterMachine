<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>FilmoMeter - Serving movie nerds since 2013</title>
		<link rel="stylesheet" href="/css/style.css">
	</head>
	<body id="home">
		<div id="layout">
			<header>
				<h1 id="logo">
					<a href="./">Filmo<span class="light">Meter</span></a>
				</h1>
				<h5>Never watch a lame-ass movie ever again</h5>
			</header>
			<hr class="noscreen">
			<section class="search">
				<form action="">
					<input class="keyword" type="text" placeholder="Movie title"></input>
					<input type="button" class="searchTrigger" value="Search"></input>
					<div class="spinner"></div>
				</form>
			</section>
			<hr class="noscreen">
			<section class="result">
				<table>
					<tbody>
						<tr>
							<td>
								<img class="poster" data-bind="attr:{src: $root.ratings()[1].poster}"></img>
							</td>
							<td>
								<div>
									<fieldset>
										<legend>Title</legend>
										<span data-bind="text: $root.ratings()[0].title"></span>
									</fieldset>
									<fieldset>
										<legend>Rating</legend>
										<span data-bind='text: averageRating'></span>
									</fieldset>
									<fieldset>
										<legend>Year</legend>
										<span data-bind='text: $root.ratings()[0].year'></span>
									</fieldset>
									<fieldset>
										<legend>Actors</legend>
										<span data-bind='text: $root.ratings()[0].actors'></span>
									</fieldset>
								</div>
							</td>
						</tr>
					</tbody>
				</table>
			</section>
			<footer>
				<span>Â© 2012 Safwan Kamarrudin</span>
			</footer>

			<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
			<script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/knockout/knockout-2.2.0.js"></script>
			<script type="text/javascript" src="https://raw.github.com/SteveSanderson/knockout.mapping/master/build/output/knockout.mapping-latest.js"></script>
			<script type="text/javascript">
				$(document).ready(function() {
					var keyword = $(':text');
      				var spinner = $('.spinner');
      				var result = $('.result');

      				$('form').submit(function(e){
    					e.preventDefault();
					});

      				search = function() {
      					if (keyword.val() != '') {
							spinner.css('visibility','visible');
							result.slideUp();

							$.getJSON('/search?title=' + keyword.val(), function(data) {
								spinner.css('visibility','hidden');
								result.slideDown();

								var viewModel = ko.mapping.fromJS(data);

								ko.applyBindings(viewModel);
							});
						}
      				};

					$(':button').click(search);

					keyword.keypress(function(e) {
						if (e.which == 13) {
							search();
						}
					});
				});
			</script>
		</div>
	</body>
</html>