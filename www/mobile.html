<!DOCTYPE html> 
<html> 
	<head> 
		<title>FilmoMeter: Serving movie nerds since 2013</title> 
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1"> 
		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.css" />
		<link rel="stylesheet" href="/css/mobile.css">
	</head> 
	<body> 

		<div data-role="page" data-theme="b" id="search-page">

			<div data-role="header" data-theme="b">
				<h1>FilmoMeter</h1>
			</div>

			<div data-role="content" data-theme="b">
				<input type="search" class="keyword" placeholder="Movie title" />
				<ul data-role="listview" data-inset="true" class="result">
					<li>
						<a href="#detail-page">
							<img class="ui-li-thumb poster" data-bind="attr:{src: $root.ratings()[1].poster}"></img>
							<span data-bind="text: $root.ratings()[0].title"></span>
							(<span data-bind="text: $root.ratings()[0].year"></span>)
						</a>
					</li>
				</ul>
			</div>

			<div data-role="footer" data-theme="b">
				<span class="source"><a href="https://github.com/safwank/FilmoMeterMachine" target="_blank">Source code</a></span>
				<span class="copyright">© 2012 <a href="mailto:shaihulud@alumni.cmu.edu?Subject=FilmoMeter%20rocks">Safwan Kamarrudin</a></span>
			</div>

		</div>

		<div data-role="page" data-theme="b" id="detail-page">

			<div data-role="header" data-theme="b">
				<h1>FilmoMeter</h1>
				<a data-role="button" data-direction="reverse" data-rel="back" href="#detail-page" data-icon="arrow-l" data-iconpos="left">Back</a>
			</div>

			<div data-role="content">
    		</div>

			<div data-role="footer" data-theme="b">
				<span class="source"><a href="https://github.com/safwank/FilmoMeterMachine" target="_blank">Source code</a></span>
				<span class="copyright">© 2012 <a href="mailto:shaihulud@alumni.cmu.edu?Subject=FilmoMeter%20rocks">Safwan Kamarrudin</a></span>
			</div>

		</div>

		<script src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
		<script src="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.js"></script>
		<script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/knockout/knockout-2.2.0.js"></script>
		<script type="text/javascript" src="https://raw.github.com/SteveSanderson/knockout.mapping/master/build/output/knockout.mapping-latest.js"></script>
		<script type="text/javascript">
			$(document).ready(function() {
				/* Variables */

				var viewModel = {};
				var keyword = $('.keyword');
  				var result = $('.result');
  				//var noResult = $('.no-result');
  				//var individualResults = $('.individual-results');
  				var individualResultsShown = false;
  				var bindingsApplied = false;

  				/* Functions */

  				search = function() {
  					if (keyword.val() != '') {
  						showSpinner();
						//resetView();

						$.getJSON('/search?title=' + keyword.val(), function(data) {
							hideSpinner();
							bindToViewModel(data);
						});
					}
  				};

  				showSpinner = function() {
  					$.mobile.showPageLoadingMsg();
  				};

  				hideSpinner = function() {
  					$.mobile.hidePageLoadingMsg();
  				};

  				resetView = function() {
					result.slideUp();
					noResult.slideUp();
					resetIndividualResults();
  				};

  				bindToViewModel = function(data) {
  					if (data == null) {
						//noResult.slideDown();
					} else {
						result.slideDown();
								
						if (!bindingsApplied) {
							viewModel = ko.mapping.fromJS(data);
							ko.applyBindings(viewModel);
							bindingsApplied = true;
						} else {
							ko.mapping.fromJS(data, viewModel);
						}
					}
  				};

  				resetIndividualResults = function() {
  					individualResults.slideUp();
  					individualResultsShown = false;
  				};

  				searchIfEnterIsPressed = function(e) {
					if (e.which == 13) {
						search();
					}
  				};

  				toggleIndividualResultsDisplay = function(e) {
					e.preventDefault();

					if (individualResultsShown) {
						resetIndividualResults();
					} else {
						individualResults.slideDown();
						individualResultsShown = true;
					}
				}

				/* Events */
				
				keyword.keypress(searchIfEnterIsPressed);

				//$('.result a').click(toggleIndividualResultsDisplay);
			});

			$(document).live('pagebeforechange', function() {
				$('[data-role=footer]').hide();
			});

			$(document).live('pagechange', function() {
				$('[data-role=footer]').show();
			});
		</script>
	</body>
</html>