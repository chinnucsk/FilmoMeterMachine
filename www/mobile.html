<!DOCTYPE html> 
<html> 
	<head> 
		<title>FilmoMeter: Serving movie nerds since 2013</title> 
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1"> 
		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.css" />
		<link rel="stylesheet" href="/css/mobile.css">
	</head> 
	<body> 

		<div data-role="page" data-theme="a">

			<div data-role="header">
				<h1>FilmoMeter</h1>
			</div>

			<div data-role="content">
				<input type="search" class="keyword" placeholder="Movie title" />
				<fieldset class="ui-grid-a, result">
					<div class="ui-block-a">
						<img class="poster" data-bind="attr:{src: $root.ratings()[1].poster}"></img>
					</div>
					<div class="ui-block-b">
						<ul data-role="listview">
							<li>
								<label>Title:</label>
								<span data-bind="text: $root.ratings()[0].title"></span>
							</li>
							<li>
								<label>Year:</label>
								<span data-bind="text: $root.ratings()[0].year"></span>
							</li>
							<li>
								<label>Actors:</label>
								<span data-bind="text: $root.ratings()[0].actors"></span>
							</li>
							<li>
								<label>Rating:</label>
								<span data-bind="text: averageRating"></span>
							</li>
							<li>
								<label>Verdict: </label>
								<span data-bind="text: verdict"></span>
							</li>
						</ul>
					</div>
				</fieldset>
			</div>

			<div data-role="footer">
				<span class="copyright">Â© 2012 <a href="mailto:shaihulud@alumni.cmu.edu?Subject=FilmoMeter%20rocks">Safwan Kamarrudin</a></span>
			</div>

		</div>

		<script src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
		<script src="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.js"></script>
		<script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/knockout/knockout-2.2.0.js"></script>
		<script type="text/javascript" src="https://raw.github.com/SteveSanderson/knockout.mapping/master/build/output/knockout.mapping-latest.js"></script>
		<script type="text/javascript">
			$(document).ready(function() {
				/* Variables */

				var viewModel = {};
				var keyword = $('.keyword');
  				var result = $('.result');
  				//var noResult = $('.no-result');
  				//var individualResults = $('.individual-results');
  				var individualResultsShown = false;
  				var bindingsApplied = false;

  				/* Functions */

  				search = function() {
  					if (keyword.val() != '') {
  						showSpinner();
						//resetView();

						$.getJSON('/search?title=' + keyword.val(), function(data) {
							hideSpinner();
							bindToViewModel(data);
						});
					}
  				};

  				showSpinner = function() {
  					$.mobile.showPageLoadingMsg();
  				};

  				hideSpinner = function() {
  					$.mobile.hidePageLoadingMsg();
  				};

  				resetView = function() {
					result.slideUp();
					noResult.slideUp();
					resetIndividualResults();
  				};

  				bindToViewModel = function(data) {
  					if (data == null) {
						//noResult.slideDown();
					} else {
						result.slideDown();
								
						if (!bindingsApplied) {
							viewModel = ko.mapping.fromJS(data);
							ko.applyBindings(viewModel);
							bindingsApplied = true;
						} else {
							ko.mapping.fromJS(data, viewModel);
						}
					}
  				};

  				resetIndividualResults = function() {
  					individualResults.slideUp();
  					individualResultsShown = false;
  				};

  				searchIfEnterIsPressed = function(e) {
					if (e.which == 13) {
						search();
					}
  				};

  				toggleIndividualResultsDisplay = function(e) {
					e.preventDefault();

					if (individualResultsShown) {
						resetIndividualResults();
					} else {
						individualResults.slideDown();
						individualResultsShown = true;
					}
				}

				/* Events */
				
				keyword.keypress(searchIfEnterIsPressed);

				//$('.result a').click(toggleIndividualResultsDisplay);
			});
		</script>
	</body>
</html>